{% extends 'base.html.twig' %}

{% block title %}{{ 'admin.dashboard.title'|trans }}{% endblock %}

{% block body %}
<div class="container mt-5 text-light">
    <div class="hero-section mb-4 p-4 p-lg-5 rounded">
        <p class="badge bg-info text-dark mb-2">#Dashboard</p>
        <h1 class="fw-bold mb-2">ğŸ“Š {{ 'admin.dashboard.heading'|trans }}</h1>
        <p class="text-muted mb-0">Vue synthÃ©tique : produits, commandes, ventes.</p>
    </div>

    <!-- Bloc 1 : Produits par catÃ©gorie -->
    <div class="card bg-dark border-info mb-4 p-4 shadow-lg">
        <h4 class="text-info mb-3">ğŸ“¦ {{ 'admin.dashboard.products_by_category'|trans }}</h4>
        <ul class="list-group list-group-flush">
            {% for category, count in productsByCategory %}
                <li class="list-group-item bg-dark text-light d-flex justify-content-between">
                    <span>{{ category }}</span>
                    <strong>{{ count }}</strong>
                </li>
            {% else %}
                <li class="list-group-item bg-dark text-muted">{{ 'category.none'|trans }}</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Bloc 2 : DerniÃ¨res commandes -->
    <div class="card bg-dark border-info mb-4 p-4 shadow-lg">
        <h4 class="text-info mb-3">ğŸ§¾ {{ 'admin.dashboard.last_orders'|trans }}</h4>
        <table class="table table-dark table-striped align-middle">
            <thead class="table-info text-dark">
                <tr>
                    <th>{{ 'admin.orders_id'|trans }}</th>
                    <th>{{ 'admin.orders_date'|trans }}</th>
                    <th>{{ 'admin.dashboard.customer'|trans }}</th>
                    <th>{{ 'admin.orders_total'|trans }}</th>
                    <th>{{ 'admin.orders_status'|trans }}</th>
                </tr>
            </thead>
            <tbody>
                {% for order in lastOrders %}
                    <tr>
                        <td>{{ order.id }}</td>
                        <td>{{ order.createdAt|date('d/m/Y H:i') }}</td>
                        <td>{{ order.user.email }}</td>
                        <td>{{ order.total }}</td>
                        {% set statusValue = order.status ? order.status.value : '' %}
                        {% set statusKey = statusValue ? 'order_status.' ~ statusValue : '' %}
                        {% set badgeClass =
                            statusValue == 'livrÃ©e' ? 'success' :
                            (statusValue == 'expÃ©diÃ©e' ? 'info' :
                            (statusValue == 'en prÃ©paration' ? 'warning text-dark' :
                            (statusValue == 'annulÃ©e' ? 'danger' : 'secondary'))) %}
                        <td><span class="badge bg-{{ badgeClass }}">{{ statusKey ? statusKey|trans : statusValue }}</span></td>
                    </tr>
                {% else %}
                    <tr><td colspan="5" class="text-center text-muted">{{ 'admin.orders_none'|trans }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Bloc 3 : Ratio disponibilitÃ© -->
    <div class="card bg-dark border-info mb-4 p-4 shadow-lg">
        <h4 class="text-info mb-3">âš–ï¸ {{ 'admin.dashboard.availability'|trans }}</h4>
        <div class="row text-center">
            {% for label, ratio in ratios %}
                <div class="col-md-4">
                    <div class="p-3 border rounded bg-dark shadow-sm">
                        {% set statusKey = 'status_labels.' ~ label %}
                        <h5 class="text-light">{{ statusKey|trans }}</h5>
                        <p class="text-info fw-bold">{{ ratio }}%</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bloc 4 : Montant total des ventes -->
    <div class="card bg-dark border-info p-4 mb-5 shadow-lg">
        <h4 class="text-info mb-3">ğŸ’° {{ 'admin.dashboard.sales_title'|trans }}</h4>
        <table class="table table-dark table-striped">
            <thead class="table-info text-dark">
                <tr>
                    <th>{{ 'admin.dashboard.month'|trans }}</th>
                    <th>{{ 'admin.orders_total'|trans }}</th>
                </tr>
            </thead>
            <tbody>
                {% for data in salesData %}
                    <tr>
                        <td>{{ data.month }}</td>
                        <td>{{ data.total|number_format(2, ',', ' ') }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="2" class="text-center text-muted">{{ 'admin.dashboard.no_sales'|trans }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.hero-section {
    background: radial-gradient(circle at 20% 20%, rgba(13,202,240,0.12), transparent 30%), #0f131a;
    border: 1px solid rgba(13,202,240,0.2);
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
}
.card {
    transition: 0.3s;
}
.card:hover {
    box-shadow: 0 0 15px rgba(13, 202, 240, 0.4);
}
</style>
{% endblock %}
