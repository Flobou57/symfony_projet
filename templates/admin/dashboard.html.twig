{% extends 'base.html.twig' %}

{% block title %}{{ 'admin.dashboard.title'|trans }}{% endblock %}

{% block body %}
<div class="container mt-5 text-light">
    <h1 class="text-info text-center mb-5 fw-bold">ğŸ“Š {{ 'admin.dashboard.heading'|trans }}</h1>

    <!-- Bloc 1 : Produits par catÃ©gorie -->
    <div class="card bg-dark border-info mb-4 p-4">
        <h4 class="text-info mb-3">ğŸ“¦ {{ 'admin.dashboard.products_by_category'|trans }}</h4>
        <ul class="list-group list-group-flush">
            {% for category, count in productsByCategory %}
                <li class="list-group-item bg-dark text-light d-flex justify-content-between">
                    <span>{{ category }}</span>
                    <strong>{{ count }}</strong>
                </li>
            {% else %}
                <li class="list-group-item bg-dark text-muted">{{ 'category.none'|trans }}</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Bloc 2 : DerniÃ¨res commandes -->
    <div class="card bg-dark border-info mb-4 p-4">
        <h4 class="text-info mb-3">ğŸ§¾ {{ 'admin.dashboard.last_orders'|trans }}</h4>
        <table class="table table-dark table-striped align-middle">
            <thead class="table-info text-dark">
                <tr>
                    <th>{{ 'admin.orders_id'|trans }}</th>
                    <th>{{ 'admin.orders_date'|trans }}</th>
                    <th>{{ 'admin.dashboard.customer'|trans }}</th>
                    <th>{{ 'admin.orders_total'|trans }}</th>
                    <th>{{ 'admin.orders_status'|trans }}</th>
                </tr>
            </thead>
            <tbody>
                {% for order in lastOrders %}
                    <tr>
                        <td>{{ order.id }}</td>
                        <td>{{ order.createdAt|date('d/m/Y H:i') }}</td>
                        <td>{{ order.user.email }}</td>
                        <td>{{ order.total }}</td>
                        {% set statusKey = order.status == 'livrÃ©e' ? 'admin.status_delivered' : (order.status == 'en attente' ? 'admin.status_pending' : order.status) %}
                        <td><span class="badge bg-{{ order.status == 'livrÃ©e' ? 'success' : 'secondary' }}">{{ statusKey|trans }}</span></td>
                    </tr>
                {% else %}
                    <tr><td colspan="5" class="text-center text-muted">{{ 'admin.orders_none'|trans }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Bloc 3 : Ratio disponibilitÃ© -->
    <div class="card bg-dark border-info mb-4 p-4">
        <h4 class="text-info mb-3">âš–ï¸ {{ 'admin.dashboard.availability'|trans }}</h4>
        <div class="row text-center">
            {% for label, ratio in ratios %}
                <div class="col-md-4">
                    <div class="p-3 border rounded bg-dark shadow-sm">
                        {% set statusKey = 'status_labels.' ~ label %}
                        <h5 class="text-light">{{ statusKey|trans }}</h5>
                        <p class="text-info fw-bold">{{ ratio }}%</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bloc 4 : Montant total des ventes -->
    <div class="card bg-dark border-info p-4 mb-5">
        <h4 class="text-info mb-3">ğŸ’° {{ 'admin.dashboard.sales_title'|trans }}</h4>
        <table class="table table-dark table-striped">
            <thead class="table-info text-dark">
                <tr>
                    <th>{{ 'admin.dashboard.month'|trans }}</th>
                    <th>{{ 'admin.orders_total'|trans }}</th>
                </tr>
            </thead>
            <tbody>
                {% for data in salesData %}
                    <tr>
                        <td>{{ data.month }}</td>
                        <td>{{ data.total|number_format(2, ',', ' ') }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="2" class="text-center text-muted">{{ 'admin.dashboard.no_sales'|trans }}</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.card {
    transition: 0.3s;
}
.card:hover {
    box-shadow: 0 0 15px rgba(13, 202, 240, 0.4);
}
</style>
{% endblock %}
